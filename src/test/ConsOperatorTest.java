package test;


import beast.base.inference.MCMC;
import beast.base.inference.parameter.RealParameter;
import beast.base.evolution.alignment.Alignment;
import beast.base.evolution.alignment.Sequence;
import beast.base.evolution.RateStatistic;
import beast.base.evolution.speciation.YuleModel;
import beast.base.evolution.tree.coalescent.RandomTree;
import beast.base.evolution.tree.Tree;
import beast.base.evolution.tree.coalescent.ConstantPopulation;
import beast.base.inference.distribution.LogNormalDistributionModel;
import beast.base.util.Randomizer;
import consoperators.InConstantDistanceOperator;
import beast.base.evolution.branchratemodel.UCRelaxedClockModel;
import beast.base.evolution.tree.TreeParser;
import consoperators.IndependentOperator;
import consoperators.SmallPulley;
import junit.framework.TestCase;
import consoperators.BigPulley;

import beast.base.evolution.tree.Node;
import beast.base.inference.State;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import org.junit.Test;


public class ConsOperatorTest extends TestCase {

    String newick1 = "((A:1.0,B:1.0):2.0,(C:0.5,D:0.5):2.5)";
    TreeParser tree1 = new TreeParser(newick1, false, false, true, 0);

    String newick2 = "(((((1:0.00872010198707326,9:0.00872010198707326):0.030771257643542042,14:0.0394913596306153):0.30143511938748785,6:0.34092647901810313):0.1863322844004357,(((((3:0.07886296950815978,20:0.07886296950815978):0.05019104312226315,17:0.12905401263042293):0.10238360676036459,18:0.23143761939078752):0.1718077243493464,(7:0.12865842769006086,12:0.12865842769006086):0.27458691605007307):0.03100799483453648,(8:0.3685857738238387,10:0.3685857738238387):0.06566756475083169):0.09300542484386842):0.3766867107837537,((((((2:0.11127637809340511,4:0.11127637809340511):0.056693352157403495,5:0.1679697302508086):0.01322917519205255,19:0.18119890544286116):0.11451012659243476,(13:0.14239185139273583,16:0.14239185139273583):0.15331718064256009):0.06751856766362746,15:0.3632275996989234):0.07335174765592634,11:0.4365793473548497):0.46736612684744283)";
    TreeParser tree2 = new TreeParser(newick2, false, false, true, 0);

    String newick3 = "((((((((1:0.1979931767337083,((29:0.001987129875097189,56:0.001987129875097189):0.009289088077704944,59:0.011276217952802132):0.1867169587809062):0.03665251046666482,(3:0.06863935938913808,109:0.06863935938913808):0.16600632781123503):0.07426349674095648,(25:0.03343838696119653,93:0.03343838696119653):0.27547079698013305):0.2383730269530122,83:0.5472822108943418):0.2774304477874483,(((17:0.04110296347326264,82:0.04110296347326264):0.5408196335052436,40:0.5819225969785062):0.21046571485315035,53:0.7923883118316566):0.03232434685013352):0.664822475154103,((((6:0.4722705108524365,(33:0.21859386620598617,45:0.21859386620598617):0.25367664464645034):0.1501751392900325,57:0.622445650142469):0.3432115927132321,((34:0.050165173196762246,49:0.050165173196762246):0.5526900191488474,(41:0.11985034455394873,94:0.11985034455394873):0.483004847791661):0.3628020505100914):0.0553030826119969,(98:0.4182832806095309,112:0.4182832806095309):0.6026770448581671):0.4685748083681951):0.060534929613965005,(((((((5:0.27695317901703104,23:0.27695317901703104):0.39488749081512536,(10:0.36012255502943186,((20:0.004343197916905333,48:0.004343197916905333):0.11775477434459013,84:0.12209797226149546):0.2380245827679364):0.31171811480272454):0.10433703027313912,(26:0.07520907229218292,43:0.07520907229218292):0.7009686278131126):0.3324682710202248,((((15:0.2765236149053445,91:0.2765236149053445):0.041415762170302184,(36:0.2224294934493326,(61:0.0691033296916207,(70:0.031327195053236695,119:0.031327195053236695):0.037776134638384):0.1533261637577119):0.09550988362631407):0.1061058209947991,100:0.4240451980704458):0.5336287008965213,(46:0.6739094280600448,(80:0.08854756426508856,97:0.08854756426508856):0.5853618637949562):0.28376447090692214):0.15097207215855335):0.0043128042593505445,(35:0.3106483371493068,76:0.3106483371493068):0.8023104382355641):0.01222722443508828,((((8:0.25235032364308657,(12:0.020748635282172634,75:0.020748635282172634):0.23160168836091394):0.1641313721529395,(62:0.31466335337942625,81:0.31466335337942625):0.10181834241659982):0.0684987407470829,(60:0.018244719287606518,(67:0.010077176264487403,101:0.010077176264487403):0.008167543023119115):0.46673571725550245):0.1361274478706258,(38:0.33263228616638707,88:0.33263228616638707):0.2884755982473477):0.5040781154062244):0.34762955273682605,(((((21:0.05176754189018472,78:0.05176754189018472):0.05626721646578668,(32:0.0390353248629992,111:0.0390353248629992):0.06899943349297219):0.2922427375588321,(24:0.3756252107895931,50:0.3756252107895931):0.02465228512521045):0.28330053460906635,63:0.6835780305238699):0.061021785152751584,((((30:0.1100121507009119,95:0.1100121507009119):0.01054734216084073,58:0.12055949286175263):0.007764741290874955,106:0.1283242341526276):0.010961244293835187,(55:0.10476052098710459,66:0.10476052098710459):0.034524957459358185):0.6053143372301587):0.7282157368801637):0.07725451089307289):0.3764639164783674,((((((((2:0.11402230014176318,86:0.11402230014176318):0.12377195311469391,9:0.2377942532564571):0.08010987083242,((14:0.005048797892223512,42:0.005048797892223512):0.2975852506101965,22:0.30263404850242):0.0152700755864571):0.6229215765167719,((44:0.24607518234402898,99:0.24607518234402898):0.39842918927398135,(89:0.44248575516153,120:0.44248575516153):0.20201861645648034):0.29632132898763874):0.021200953488906382,96:0.9620266540945555):0.11309331279881629,((11:0.15876348853374284,(110:0.06354593215350665,114:0.06354593215350665):0.09521755638023618):0.5944220162485343,69:0.7531855047822771):0.32193446211109467):0.21008006620394726,(((16:0.21508957589536332,((39:0.06735011692521842,72:0.06735011692521842):0.06141231858577245,118:0.12876243551099087):0.08632714038437245):0.056462050993480395,27:0.2715516268888437):0.15963606930502605,(((19:0.023081812385401718,105:0.023081812385401718):0.17756506920199658,(85:0.11990648690272818,90:0.11990648690272818):0.08074039468467012):0.05121466935786223,77:0.2518615509452605):0.17932614524860924):0.8540123369034492):0.35833417660668143,(((((((4:0.04886673152751227,(79:0.02841294181012128,92:0.02841294181012128):0.020453789717390987):0.1841394986101228,65:0.23300623013763508):0.08630633009243407,(13:0.28508873806871343,108:0.28508873806871343):0.03422382216135572):0.070981506062684,(103:0.152062448955412,107:0.152062448955412):0.23823161733734116):0.2407251878368229,(71:0.45844428182488,115:0.45844428182488):0.17257497230469604):0.7027926447710426,(((7:0.455232018965783,116:0.455232018965783):0.21717200965847883,(((51:0.07525401970399374,87:0.07525401970399374):0.003084860382546392,(64:0.024406941203500065,113:0.024406941203500065):0.05393193888304007):0.5768810765489909,(((54:0.06856795061471396,102:0.06856795061471396):0.14725193340809906,104:0.21581988402281302):0.3801682580938264,73:0.5959881421166394):0.05923181451889159):0.017184071988730842):0.5312666662969483,((18:0.019740135755025055,74:0.019740135755025055):0.29902632335698665,47:0.3187664591120117):0.8849042358091985):0.13014120397940854):0.11789372979258328,((((28:0.2103975489827134,52:0.2103975489827134):0.15920730340436806,37:0.36960485238708146):0.31583189670364614,31:0.6854367490907276):0.4859708168385988,(68:0.9220213704128001,117:0.9220213704128001):0.2493861955165263):0.2802980627638756):0.19182858101079847):0.28299977022422507)";
    TreeParser tree3 = new TreeParser(newick3, false, false, true, 0);



    @Test
    public void testSampleTree () {


        LogNormalDistributionModel LN1= new LogNormalDistributionModel();
        LN1.initByName("M",new RealParameter("1.0"),"S",new RealParameter("0.2"),"meanInRealSpace","true");


        UCRelaxedClockModel RelaxedClock1 =new UCRelaxedClockModel();
        //RelaxedClock1.initByName("distr",LN1,"tree",tree1,"rates",new RealParameter("1.0 1.1 0.9 0.9 0.8 0.9"));
        //RelaxedClock1.initByName("distr",LN1,"tree",tree2,"rates",new RealParameter("0.943129515204806 1.03615371717961 0.98695339058137 0.952234749322906 0.947285435196074 0.963546283022697 1.06052471834737 1.02819910581732 0.9181788566429 0.99933801178691 1.04713589072696 0.991798399131631 0.98147600668994 0.978321823265657 0.941312378824899 0.947851945236383 0.903631379918739 1.0083840696137 0.96499151788126 1.08710907903792 1.03188403236629 0.958526283617504 1.1017213692781 1.01676251788067 0.968586449117302 0.942974038827426 1.03650275212716 0.948816941486763 1.01496157112161 0.956190591455658 1.03838668094401 1.01580580459327 0.966791514254149 0.945171537453263 0.875028672563375 0.947334644250084 1.07062181655376 0.882803176706224"));
        RelaxedClock1.initByName("distr",LN1,"tree",tree3,"rates",new RealParameter("0.936091621853684 0.827386337524583 0.946342272292745 1.14154307499299 1.01675441592264 1.10071933247179 0.938004494939011 0.999129519644019 0.979194454999476 0.936112377208736 0.956382021701549 1.02603207217186 1.1323129181369 1.13370514829222 0.891983072932866 0.905895265216444 0.988097588600761 0.962050079646447 0.970957508580484 0.867234671001135 1.1465648900547 0.987148028411761 0.799344868437366 0.848259370535449 0.854023329030513 1.14336960392016 0.778230071611815 0.881699931501436 0.860911479448604 0.964685197570033 1.05300140635224 0.926002187470409 0.976639070370879 0.955457715428828 0.867572613332755 0.950366482610039 0.963324914499785 1.04308284586678 1.23758146229506 0.957429157353827 0.968487791499607 1.05139260610169 1.17723967260696 1.07567040139538 0.811371284632794 1.08765693871303 1.14877823667043 0.92080860585898 1.16900594537437 0.841375688458337 0.96416483076729 1.06177674075481 0.985573206548009 1.14924256514485 1.29704811706245 1.07898538402534 0.90856060837337 1.02283826811532 1.32084207363198 1.21044681883064 0.878150438918473 0.915093304452645 0.985860039114238 0.948603247080185 0.922676362453785 0.907914143419169 1.08196285872999 0.955601359073571 1.22945857100824 0.966352883139802 0.767887334676015 1.07930953425025 0.926159271885228 0.9959130958819 1.06803197442459 1.01908983905378 1.03576764293648 1.02541846971311 1.42299420691329 0.932934005640958 0.810852905956823 1.07624268820765 0.921421389572459 0.759506802196918 0.817542811801588 0.984159385723081 0.758616866943654 0.855938005409555 1.20642299627831 1.21721552421823 1.03807802181605 1.05558347917566 1.18150301907748 1.05673041905265 1.09201875914059 0.922118892190875 1.12931151466209 0.914173040956408 1.09845978580576 0.841276314935983 0.937062569691937 0.806394111526533 0.803915837235395 0.721328987364484 0.860012833490427 1.08600113321781 1.05219593381519 0.909057696084391 1.02165527977831 1.17729936344134 0.945034993811658 0.884457707522978 0.960853839762367 1.20413408579109 1.177808618017 0.892579969792417 1.00801302560682 1.1052540322086 0.845171790611036 0.920843898196977 0.908095505082499 1.14137294858032 1.20432684261134 1.04726515967906 0.973060277874612 1.30973233168183 1.1559398139765 1.07733830326901 0.878354218948212 1.12758004780767 1.28749409929411 1.12064696451211 1.14051042480629 0.838800367374301 0.973607291526751 1.06493148663343 0.86464523978537 1.03736640649312 1.01929029414455 0.763326969043799 0.945931109919182 1.0218290597935 1.26581688037351 0.93432551453898 0.798403657037627 0.954907780264906 1.0273311920502 1.07391538825214 0.868591754901503 0.835582709913381 0.812408700085709 1.03237432944637 0.943441585256152 0.84572838069436 1.04535385967544 1.4057373035605 1.02807714593852 0.942798567617865 0.994129634591114 0.912121678641745 1.00662226046006 1.05549770257239 0.7888394969048 0.943468286619395 0.859394242395583 0.980764610164902 1.09769393336876 1.08951570151555 0.882919133511048 0.930243827593475 1.00307438260207 0.948823439306213 0.827169638043716 1.04724769925006 0.97658075079614 1.04583605831314 0.677813702538089 1.02671747333154 1.06946316858258 1.13982965589736 1.29528288628662 1.14243831464842 0.891726892274575 1.14654581686529 1.16480994339659 0.975678182924859 0.959482169968076 1.06201127128278 1.41112197334174 0.739887669017598 0.996877848880585 0.794097757693482 1.18493684574048 0.840879362579336 0.976458542292366 0.830011583729198 0.864428700890303 0.972488488569087 1.05411637675336 0.902772120852771 1.30856950841522 1.08002773343926 1.12214982006623 1.13973746880955 0.861814125147005 0.886367904026699 1.11863194654359 0.865831181039771 0.800668116105316 0.917336385932314 1.20488470944041 1.13301418297575 0.946249016390257 0.846980647903207 1.3070588853613 0.835523898630557 0.982961677232368 1.13985962682264 1.16923939517873 1.16198115346818 0.925908467940748 0.956397300088686 1.03351415167038 1.04146289773174 1.01734857578877 0.873072004774609 0.873388803894881 0.873869449386848 0.854794599057397 1.13833971125634 1.03001977033945 0.899631160760152 1.03990909156482 1.0977125515043 1.13115476025937 0.982452039507629 0.894306082958243 1.1637739785244"));

        //InConstantDistanceOperator operator = new InConstantDistanceOperator();
        //operator.initByName("branchRateModel",RelaxedClock1,"tree",tree1,"twindowSize",0.1,"rates",new RealParameter("1.0 1.1 0.9 0.9 0.8 0.9"),"weight",10.0);
        //operator.initByName("branchRateModel",RelaxedClock1,"tree",tree2,"twindowSize",0.1,"rates",new RealParameter(""),"weight",10.0);
        //operator.initByName("branchRateModel",RelaxedClock1,"tree",tree3,"twindowSize",0.1,"rates",new RealParameter("0.936091621853684 0.827386337524583 0.946342272292745 1.14154307499299 1.01675441592264 1.10071933247179 0.938004494939011 0.999129519644019 0.979194454999476 0.936112377208736 0.956382021701549 1.02603207217186 1.1323129181369 1.13370514829222 0.891983072932866 0.905895265216444 0.988097588600761 0.962050079646447 0.970957508580484 0.867234671001135 1.1465648900547 0.987148028411761 0.799344868437366 0.848259370535449 0.854023329030513 1.14336960392016 0.778230071611815 0.881699931501436 0.860911479448604 0.964685197570033 1.05300140635224 0.926002187470409 0.976639070370879 0.955457715428828 0.867572613332755 0.950366482610039 0.963324914499785 1.04308284586678 1.23758146229506 0.957429157353827 0.968487791499607 1.05139260610169 1.17723967260696 1.07567040139538 0.811371284632794 1.08765693871303 1.14877823667043 0.92080860585898 1.16900594537437 0.841375688458337 0.96416483076729 1.06177674075481 0.985573206548009 1.14924256514485 1.29704811706245 1.07898538402534 0.90856060837337 1.02283826811532 1.32084207363198 1.21044681883064 0.878150438918473 0.915093304452645 0.985860039114238 0.948603247080185 0.922676362453785 0.907914143419169 1.08196285872999 0.955601359073571 1.22945857100824 0.966352883139802 0.767887334676015 1.07930953425025 0.926159271885228 0.9959130958819 1.06803197442459 1.01908983905378 1.03576764293648 1.02541846971311 1.42299420691329 0.932934005640958 0.810852905956823 1.07624268820765 0.921421389572459 0.759506802196918 0.817542811801588 0.984159385723081 0.758616866943654 0.855938005409555 1.20642299627831 1.21721552421823 1.03807802181605 1.05558347917566 1.18150301907748 1.05673041905265 1.09201875914059 0.922118892190875 1.12931151466209 0.914173040956408 1.09845978580576 0.841276314935983 0.937062569691937 0.806394111526533 0.803915837235395 0.721328987364484 0.860012833490427 1.08600113321781 1.05219593381519 0.909057696084391 1.02165527977831 1.17729936344134 0.945034993811658 0.884457707522978 0.960853839762367 1.20413408579109 1.177808618017 0.892579969792417 1.00801302560682 1.1052540322086 0.845171790611036 0.920843898196977 0.908095505082499 1.14137294858032 1.20432684261134 1.04726515967906 0.973060277874612 1.30973233168183 1.1559398139765 1.07733830326901 0.878354218948212 1.12758004780767 1.28749409929411 1.12064696451211 1.14051042480629 0.838800367374301 0.973607291526751 1.06493148663343 0.86464523978537 1.03736640649312 1.01929029414455 0.763326969043799 0.945931109919182 1.0218290597935 1.26581688037351 0.93432551453898 0.798403657037627 0.954907780264906 1.0273311920502 1.07391538825214 0.868591754901503 0.835582709913381 0.812408700085709 1.03237432944637 0.943441585256152 0.84572838069436 1.04535385967544 1.4057373035605 1.02807714593852 0.942798567617865 0.994129634591114 0.912121678641745 1.00662226046006 1.05549770257239 0.7888394969048 0.943468286619395 0.859394242395583 0.980764610164902 1.09769393336876 1.08951570151555 0.882919133511048 0.930243827593475 1.00307438260207 0.948823439306213 0.827169638043716 1.04724769925006 0.97658075079614 1.04583605831314 0.677813702538089 1.02671747333154 1.06946316858258 1.13982965589736 1.29528288628662 1.14243831464842 0.891726892274575 1.14654581686529 1.16480994339659 0.975678182924859 0.959482169968076 1.06201127128278 1.41112197334174 0.739887669017598 0.996877848880585 0.794097757693482 1.18493684574048 0.840879362579336 0.976458542292366 0.830011583729198 0.864428700890303 0.972488488569087 1.05411637675336 0.902772120852771 1.30856950841522 1.08002773343926 1.12214982006623 1.13973746880955 0.861814125147005 0.886367904026699 1.11863194654359 0.865831181039771 0.800668116105316 0.917336385932314 1.20488470944041 1.13301418297575 0.946249016390257 0.846980647903207 1.3070588853613 0.835523898630557 0.982961677232368 1.13985962682264 1.16923939517873 1.16198115346818 0.925908467940748 0.956397300088686 1.03351415167038 1.04146289773174 1.01734857578877 0.873072004774609 0.873388803894881 0.873869449386848 0.854794599057397 1.13833971125634 1.03001977033945 0.899631160760152 1.03990909156482 1.0977125515043 1.13115476025937 0.982452039507629 0.894306082958243 1.1637739785244"),"weight",10.0);

        //SmallPulleyV1 operator = new SmallPulleyV1();
        //operator.initByName("branchRateModel",RelaxedClock1,"tree",tree1,"dwindowSize",0.1,"rates",new RealParameter("1.0 1.1 0.9 0.9 0.8 0.9"),"weight",10.0);
        //operator.initByName("branchRateModel",RelaxedClock1,"tree",tree2,"dwindowSize",0.1,"rates",new RealParameter(""),"weight",10.0);
       //operator.initByName("branchRateModel",RelaxedClock1,"tree",tree3,"dwindowSize",0.1,"rates",new RealParameter("0.936091621853684 0.827386337524583 0.946342272292745 1.14154307499299 1.01675441592264 1.10071933247179 0.938004494939011 0.999129519644019 0.979194454999476 0.936112377208736 0.956382021701549 1.02603207217186 1.1323129181369 1.13370514829222 0.891983072932866 0.905895265216444 0.988097588600761 0.962050079646447 0.970957508580484 0.867234671001135 1.1465648900547 0.987148028411761 0.799344868437366 0.848259370535449 0.854023329030513 1.14336960392016 0.778230071611815 0.881699931501436 0.860911479448604 0.964685197570033 1.05300140635224 0.926002187470409 0.976639070370879 0.955457715428828 0.867572613332755 0.950366482610039 0.963324914499785 1.04308284586678 1.23758146229506 0.957429157353827 0.968487791499607 1.05139260610169 1.17723967260696 1.07567040139538 0.811371284632794 1.08765693871303 1.14877823667043 0.92080860585898 1.16900594537437 0.841375688458337 0.96416483076729 1.06177674075481 0.985573206548009 1.14924256514485 1.29704811706245 1.07898538402534 0.90856060837337 1.02283826811532 1.32084207363198 1.21044681883064 0.878150438918473 0.915093304452645 0.985860039114238 0.948603247080185 0.922676362453785 0.907914143419169 1.08196285872999 0.955601359073571 1.22945857100824 0.966352883139802 0.767887334676015 1.07930953425025 0.926159271885228 0.9959130958819 1.06803197442459 1.01908983905378 1.03576764293648 1.02541846971311 1.42299420691329 0.932934005640958 0.810852905956823 1.07624268820765 0.921421389572459 0.759506802196918 0.817542811801588 0.984159385723081 0.758616866943654 0.855938005409555 1.20642299627831 1.21721552421823 1.03807802181605 1.05558347917566 1.18150301907748 1.05673041905265 1.09201875914059 0.922118892190875 1.12931151466209 0.914173040956408 1.09845978580576 0.841276314935983 0.937062569691937 0.806394111526533 0.803915837235395 0.721328987364484 0.860012833490427 1.08600113321781 1.05219593381519 0.909057696084391 1.02165527977831 1.17729936344134 0.945034993811658 0.884457707522978 0.960853839762367 1.20413408579109 1.177808618017 0.892579969792417 1.00801302560682 1.1052540322086 0.845171790611036 0.920843898196977 0.908095505082499 1.14137294858032 1.20432684261134 1.04726515967906 0.973060277874612 1.30973233168183 1.1559398139765 1.07733830326901 0.878354218948212 1.12758004780767 1.28749409929411 1.12064696451211 1.14051042480629 0.838800367374301 0.973607291526751 1.06493148663343 0.86464523978537 1.03736640649312 1.01929029414455 0.763326969043799 0.945931109919182 1.0218290597935 1.26581688037351 0.93432551453898 0.798403657037627 0.954907780264906 1.0273311920502 1.07391538825214 0.868591754901503 0.835582709913381 0.812408700085709 1.03237432944637 0.943441585256152 0.84572838069436 1.04535385967544 1.4057373035605 1.02807714593852 0.942798567617865 0.994129634591114 0.912121678641745 1.00662226046006 1.05549770257239 0.7888394969048 0.943468286619395 0.859394242395583 0.980764610164902 1.09769393336876 1.08951570151555 0.882919133511048 0.930243827593475 1.00307438260207 0.948823439306213 0.827169638043716 1.04724769925006 0.97658075079614 1.04583605831314 0.677813702538089 1.02671747333154 1.06946316858258 1.13982965589736 1.29528288628662 1.14243831464842 0.891726892274575 1.14654581686529 1.16480994339659 0.975678182924859 0.959482169968076 1.06201127128278 1.41112197334174 0.739887669017598 0.996877848880585 0.794097757693482 1.18493684574048 0.840879362579336 0.976458542292366 0.830011583729198 0.864428700890303 0.972488488569087 1.05411637675336 0.902772120852771 1.30856950841522 1.08002773343926 1.12214982006623 1.13973746880955 0.861814125147005 0.886367904026699 1.11863194654359 0.865831181039771 0.800668116105316 0.917336385932314 1.20488470944041 1.13301418297575 0.946249016390257 0.846980647903207 1.3070588853613 0.835523898630557 0.982961677232368 1.13985962682264 1.16923939517873 1.16198115346818 0.925908467940748 0.956397300088686 1.03351415167038 1.04146289773174 1.01734857578877 0.873072004774609 0.873388803894881 0.873869449386848 0.854794599057397 1.13833971125634 1.03001977033945 0.899631160760152 1.03990909156482 1.0977125515043 1.13115476025937 0.982452039507629 0.894306082958243 1.1637739785244"),"weight",10.0);

        //BigPulley operator = new BigPulley();
        //operator.initByName("branchRateModel",RelaxedClock1,"tree",tree1,"dwindowSize",0.1,"twindowSize",0.1,"rates",new RealParameter("1.0 1.1 0.9 0.9 0.8 0.9"),"weight",10.0);
        //operator.initByName("branchRateModel",RelaxedClock1,"tree",tree2,"dwindowSize",0.1,"twindowSize",0.1,"rates",new RealParameter(""),"weight",10.0);
        //operator.initByName("branchRateModel",RelaxedClock1,"tree",tree3,"dwindowSize",0.1,"twindowSize",0.1,"rates",new RealParameter("0.936091621853684 0.827386337524583 0.946342272292745 1.14154307499299 1.01675441592264 1.10071933247179 0.938004494939011 0.999129519644019 0.979194454999476 0.936112377208736 0.956382021701549 1.02603207217186 1.1323129181369 1.13370514829222 0.891983072932866 0.905895265216444 0.988097588600761 0.962050079646447 0.970957508580484 0.867234671001135 1.1465648900547 0.987148028411761 0.799344868437366 0.848259370535449 0.854023329030513 1.14336960392016 0.778230071611815 0.881699931501436 0.860911479448604 0.964685197570033 1.05300140635224 0.926002187470409 0.976639070370879 0.955457715428828 0.867572613332755 0.950366482610039 0.963324914499785 1.04308284586678 1.23758146229506 0.957429157353827 0.968487791499607 1.05139260610169 1.17723967260696 1.07567040139538 0.811371284632794 1.08765693871303 1.14877823667043 0.92080860585898 1.16900594537437 0.841375688458337 0.96416483076729 1.06177674075481 0.985573206548009 1.14924256514485 1.29704811706245 1.07898538402534 0.90856060837337 1.02283826811532 1.32084207363198 1.21044681883064 0.878150438918473 0.915093304452645 0.985860039114238 0.948603247080185 0.922676362453785 0.907914143419169 1.08196285872999 0.955601359073571 1.22945857100824 0.966352883139802 0.767887334676015 1.07930953425025 0.926159271885228 0.9959130958819 1.06803197442459 1.01908983905378 1.03576764293648 1.02541846971311 1.42299420691329 0.932934005640958 0.810852905956823 1.07624268820765 0.921421389572459 0.759506802196918 0.817542811801588 0.984159385723081 0.758616866943654 0.855938005409555 1.20642299627831 1.21721552421823 1.03807802181605 1.05558347917566 1.18150301907748 1.05673041905265 1.09201875914059 0.922118892190875 1.12931151466209 0.914173040956408 1.09845978580576 0.841276314935983 0.937062569691937 0.806394111526533 0.803915837235395 0.721328987364484 0.860012833490427 1.08600113321781 1.05219593381519 0.909057696084391 1.02165527977831 1.17729936344134 0.945034993811658 0.884457707522978 0.960853839762367 1.20413408579109 1.177808618017 0.892579969792417 1.00801302560682 1.1052540322086 0.845171790611036 0.920843898196977 0.908095505082499 1.14137294858032 1.20432684261134 1.04726515967906 0.973060277874612 1.30973233168183 1.1559398139765 1.07733830326901 0.878354218948212 1.12758004780767 1.28749409929411 1.12064696451211 1.14051042480629 0.838800367374301 0.973607291526751 1.06493148663343 0.86464523978537 1.03736640649312 1.01929029414455 0.763326969043799 0.945931109919182 1.0218290597935 1.26581688037351 0.93432551453898 0.798403657037627 0.954907780264906 1.0273311920502 1.07391538825214 0.868591754901503 0.835582709913381 0.812408700085709 1.03237432944637 0.943441585256152 0.84572838069436 1.04535385967544 1.4057373035605 1.02807714593852 0.942798567617865 0.994129634591114 0.912121678641745 1.00662226046006 1.05549770257239 0.7888394969048 0.943468286619395 0.859394242395583 0.980764610164902 1.09769393336876 1.08951570151555 0.882919133511048 0.930243827593475 1.00307438260207 0.948823439306213 0.827169638043716 1.04724769925006 0.97658075079614 1.04583605831314 0.677813702538089 1.02671747333154 1.06946316858258 1.13982965589736 1.29528288628662 1.14243831464842 0.891726892274575 1.14654581686529 1.16480994339659 0.975678182924859 0.959482169968076 1.06201127128278 1.41112197334174 0.739887669017598 0.996877848880585 0.794097757693482 1.18493684574048 0.840879362579336 0.976458542292366 0.830011583729198 0.864428700890303 0.972488488569087 1.05411637675336 0.902772120852771 1.30856950841522 1.08002773343926 1.12214982006623 1.13973746880955 0.861814125147005 0.886367904026699 1.11863194654359 0.865831181039771 0.800668116105316 0.917336385932314 1.20488470944041 1.13301418297575 0.946249016390257 0.846980647903207 1.3070588853613 0.835523898630557 0.982961677232368 1.13985962682264 1.16923939517873 1.16198115346818 0.925908467940748 0.956397300088686 1.03351415167038 1.04146289773174 1.01734857578877 0.873072004774609 0.873388803894881 0.873869449386848 0.854794599057397 1.13833971125634 1.03001977033945 0.899631160760152 1.03990909156482 1.0977125515043 1.13115476025937 0.982452039507629 0.894306082958243 1.1637739785244"),"weight",10.0);


        IndependentOperator operator = new IndependentOperator();
        //operator.initByName("distr",LN1,"rates",new RealParameter("1.0 1.1 0.9 0.9 0.8 0.9"),"weight",10.0);
        //operator.initByName("distr",LN1,"rates",new RealParameter("0.943129515204806 1.03615371717961 0.98695339058137 0.952234749322906 0.947285435196074 0.963546283022697 1.06052471834737 1.02819910581732 0.9181788566429 0.99933801178691 1.04713589072696 0.991798399131631 0.98147600668994 0.978321823265657 0.941312378824899 0.947851945236383 0.903631379918739 1.0083840696137 0.96499151788126 1.08710907903792 1.03188403236629 0.958526283617504 1.1017213692781 1.01676251788067 0.968586449117302 0.942974038827426 1.03650275212716 0.948816941486763 1.01496157112161 0.956190591455658 1.03838668094401 1.01580580459327 0.966791514254149 0.945171537453263 0.875028672563375 0.947334644250084 1.07062181655376 0.882803176706224"),"weight",10.0);
        operator.initByName("distr",LN1,"rates",new RealParameter("0.936091621853684 0.827386337524583 0.946342272292745 1.14154307499299 1.01675441592264 1.10071933247179 0.938004494939011 0.999129519644019 0.979194454999476 0.936112377208736 0.956382021701549 1.02603207217186 1.1323129181369 1.13370514829222 0.891983072932866 0.905895265216444 0.988097588600761 0.962050079646447 0.970957508580484 0.867234671001135 1.1465648900547 0.987148028411761 0.799344868437366 0.848259370535449 0.854023329030513 1.14336960392016 0.778230071611815 0.881699931501436 0.860911479448604 0.964685197570033 1.05300140635224 0.926002187470409 0.976639070370879 0.955457715428828 0.867572613332755 0.950366482610039 0.963324914499785 1.04308284586678 1.23758146229506 0.957429157353827 0.968487791499607 1.05139260610169 1.17723967260696 1.07567040139538 0.811371284632794 1.08765693871303 1.14877823667043 0.92080860585898 1.16900594537437 0.841375688458337 0.96416483076729 1.06177674075481 0.985573206548009 1.14924256514485 1.29704811706245 1.07898538402534 0.90856060837337 1.02283826811532 1.32084207363198 1.21044681883064 0.878150438918473 0.915093304452645 0.985860039114238 0.948603247080185 0.922676362453785 0.907914143419169 1.08196285872999 0.955601359073571 1.22945857100824 0.966352883139802 0.767887334676015 1.07930953425025 0.926159271885228 0.9959130958819 1.06803197442459 1.01908983905378 1.03576764293648 1.02541846971311 1.42299420691329 0.932934005640958 0.810852905956823 1.07624268820765 0.921421389572459 0.759506802196918 0.817542811801588 0.984159385723081 0.758616866943654 0.855938005409555 1.20642299627831 1.21721552421823 1.03807802181605 1.05558347917566 1.18150301907748 1.05673041905265 1.09201875914059 0.922118892190875 1.12931151466209 0.914173040956408 1.09845978580576 0.841276314935983 0.937062569691937 0.806394111526533 0.803915837235395 0.721328987364484 0.860012833490427 1.08600113321781 1.05219593381519 0.909057696084391 1.02165527977831 1.17729936344134 0.945034993811658 0.884457707522978 0.960853839762367 1.20413408579109 1.177808618017 0.892579969792417 1.00801302560682 1.1052540322086 0.845171790611036 0.920843898196977 0.908095505082499 1.14137294858032 1.20432684261134 1.04726515967906 0.973060277874612 1.30973233168183 1.1559398139765 1.07733830326901 0.878354218948212 1.12758004780767 1.28749409929411 1.12064696451211 1.14051042480629 0.838800367374301 0.973607291526751 1.06493148663343 0.86464523978537 1.03736640649312 1.01929029414455 0.763326969043799 0.945931109919182 1.0218290597935 1.26581688037351 0.93432551453898 0.798403657037627 0.954907780264906 1.0273311920502 1.07391538825214 0.868591754901503 0.835582709913381 0.812408700085709 1.03237432944637 0.943441585256152 0.84572838069436 1.04535385967544 1.4057373035605 1.02807714593852 0.942798567617865 0.994129634591114 0.912121678641745 1.00662226046006 1.05549770257239 0.7888394969048 0.943468286619395 0.859394242395583 0.980764610164902 1.09769393336876 1.08951570151555 0.882919133511048 0.930243827593475 1.00307438260207 0.948823439306213 0.827169638043716 1.04724769925006 0.97658075079614 1.04583605831314 0.677813702538089 1.02671747333154 1.06946316858258 1.13982965589736 1.29528288628662 1.14243831464842 0.891726892274575 1.14654581686529 1.16480994339659 0.975678182924859 0.959482169968076 1.06201127128278 1.41112197334174 0.739887669017598 0.996877848880585 0.794097757693482 1.18493684574048 0.840879362579336 0.976458542292366 0.830011583729198 0.864428700890303 0.972488488569087 1.05411637675336 0.902772120852771 1.30856950841522 1.08002773343926 1.12214982006623 1.13973746880955 0.861814125147005 0.886367904026699 1.11863194654359 0.865831181039771 0.800668116105316 0.917336385932314 1.20488470944041 1.13301418297575 0.946249016390257 0.846980647903207 1.3070588853613 0.835523898630557 0.982961677232368 1.13985962682264 1.16923939517873 1.16198115346818 0.925908467940748 0.956397300088686 1.03351415167038 1.04146289773174 1.01734857578877 0.873072004774609 0.873388803894881 0.873869449386848 0.854794599057397 1.13833971125634 1.03001977033945 0.899631160760152 1.03990909156482 1.0977125515043 1.13115476025937 0.982452039507629 0.894306082958243 1.1637739785244"),"weight",10.0);

        operator.initAndValidate();

        operator.proposal();

    }



}
    /*
    @Test
    public void rateDistribution() throws Exception {

        Randomizer.setSeed(42);

        YuleModel bdssm =  new YuleModel();
        bdssm.setInputValue("birthDiffRate", new RealParameter("2.0"));

        ConstantPopulation constantPop = new ConstantPopulation();
        constantPop.initByName("popSize", new RealParameter("20.0"));

        List<Object> alignmentInitArgs = new ArrayList<Object>();
        for (int i=0; i<4; i++) {
            Sequence thisSeq = new Sequence();
            thisSeq.initByName("taxon", String.valueOf(i), "value", "?");
            alignmentInitArgs.add("sequence");
            alignmentInitArgs.add(thisSeq);
        }
        Alignment alignment = new Alignment();
        alignment.initByName(alignmentInitArgs.toArray());

        Tree tree = new RandomTree();
        tree.initByName("taxa", alignment, "populationModel", constantPop);

        RealParameter rates = new RealParameter();


        // Set up state:
        State state = new State();
        state.initByName("stateNode", tree);

        // Set up operator:
        InConstantDistanceOperator operator = new InConstantDistanceOperator();
        //SmallPulleyV1 operator = new SmallPulleyV1();
        //BigPulley operator = new BigPulley();
        operator.initByName("weight", 10, "tree", tree);

        RateStatistic rateReport=  new RateStatistic();
        rateReport.initByName(
                "logEvery", "100",
                "burnin", "200000",
                "credibleSetPercentage", "95.0",
                "log", rates,
                "silent", true
        );

        // Set up MCMC:
        MCMC mcmc = new MCMC();
        mcmc.initByName(
                "chainLength", "2000000",
                "state", state,
                "distribution", bdssm,
                "operator", operator,
                "logger", rateReport
        );

        // Run MCMC:
        mcmc.run();

        // Obtain analysis results:



    }

    */

    /*
    @Test
    public void testBigTree() {
        String newick2 = "((((((((1:0.1979931767337083,((29:0.001987129875097189,56:0.001987129875097189):0.009289088077704944,59:0.011276217952802132):0.1867169587809062):0.03665251046666482,(3:0.06863935938913808,109:0.06863935938913808):0.16600632781123503):0.07426349674095648,(25:0.03343838696119653,93:0.03343838696119653):0.27547079698013305):0.2383730269530122,83:0.5472822108943418):0.2774304477874483,(((17:0.04110296347326264,82:0.04110296347326264):0.5408196335052436,40:0.5819225969785062):0.21046571485315035,53:0.7923883118316566):0.03232434685013352):0.664822475154103,((((6:0.4722705108524365,(33:0.21859386620598617,45:0.21859386620598617):0.25367664464645034):0.1501751392900325,57:0.622445650142469):0.3432115927132321,((34:0.050165173196762246,49:0.050165173196762246):0.5526900191488474,(41:0.11985034455394873,94:0.11985034455394873):0.483004847791661):0.3628020505100914):0.0553030826119969,(98:0.4182832806095309,112:0.4182832806095309):0.6026770448581671):0.4685748083681951):0.060534929613965005,(((((((5:0.27695317901703104,23:0.27695317901703104):0.39488749081512536,(10:0.36012255502943186,((20:0.004343197916905333,48:0.004343197916905333):0.11775477434459013,84:0.12209797226149546):0.2380245827679364):0.31171811480272454):0.10433703027313912,(26:0.07520907229218292,43:0.07520907229218292):0.7009686278131126):0.3324682710202248,((((15:0.2765236149053445,91:0.2765236149053445):0.041415762170302184,(36:0.2224294934493326,(61:0.0691033296916207,(70:0.031327195053236695,119:0.031327195053236695):0.037776134638384):0.1533261637577119):0.09550988362631407):0.1061058209947991,100:0.4240451980704458):0.5336287008965213,(46:0.6739094280600448,(80:0.08854756426508856,97:0.08854756426508856):0.5853618637949562):0.28376447090692214):0.15097207215855335):0.0043128042593505445,(35:0.3106483371493068,76:0.3106483371493068):0.8023104382355641):0.01222722443508828,((((8:0.25235032364308657,(12:0.020748635282172634,75:0.020748635282172634):0.23160168836091394):0.1641313721529395,(62:0.31466335337942625,81:0.31466335337942625):0.10181834241659982):0.0684987407470829,(60:0.018244719287606518,(67:0.010077176264487403,101:0.010077176264487403):0.008167543023119115):0.46673571725550245):0.1361274478706258,(38:0.33263228616638707,88:0.33263228616638707):0.2884755982473477):0.5040781154062244):0.34762955273682605,(((((21:0.05176754189018472,78:0.05176754189018472):0.05626721646578668,(32:0.0390353248629992,111:0.0390353248629992):0.06899943349297219):0.2922427375588321,(24:0.3756252107895931,50:0.3756252107895931):0.02465228512521045):0.28330053460906635,63:0.6835780305238699):0.061021785152751584,((((30:0.1100121507009119,95:0.1100121507009119):0.01054734216084073,58:0.12055949286175263):0.007764741290874955,106:0.1283242341526276):0.010961244293835187,(55:0.10476052098710459,66:0.10476052098710459):0.034524957459358185):0.6053143372301587):0.7282157368801637):0.07725451089307289):0.3764639164783674,((((((((2:0.11402230014176318,86:0.11402230014176318):0.12377195311469391,9:0.2377942532564571):0.08010987083242,((14:0.005048797892223512,42:0.005048797892223512):0.2975852506101965,22:0.30263404850242):0.0152700755864571):0.6229215765167719,((44:0.24607518234402898,99:0.24607518234402898):0.39842918927398135,(89:0.44248575516153,120:0.44248575516153):0.20201861645648034):0.29632132898763874):0.021200953488906382,96:0.9620266540945555):0.11309331279881629,((11:0.15876348853374284,(110:0.06354593215350665,114:0.06354593215350665):0.09521755638023618):0.5944220162485343,69:0.7531855047822771):0.32193446211109467):0.21008006620394726,(((16:0.21508957589536332,((39:0.06735011692521842,72:0.06735011692521842):0.06141231858577245,118:0.12876243551099087):0.08632714038437245):0.056462050993480395,27:0.2715516268888437):0.15963606930502605,(((19:0.023081812385401718,105:0.023081812385401718):0.17756506920199658,(85:0.11990648690272818,90:0.11990648690272818):0.08074039468467012):0.05121466935786223,77:0.2518615509452605):0.17932614524860924):0.8540123369034492):0.35833417660668143,(((((((4:0.04886673152751227,(79:0.02841294181012128,92:0.02841294181012128):0.020453789717390987):0.1841394986101228,65:0.23300623013763508):0.08630633009243407,(13:0.28508873806871343,108:0.28508873806871343):0.03422382216135572):0.070981506062684,(103:0.152062448955412,107:0.152062448955412):0.23823161733734116):0.2407251878368229,(71:0.45844428182488,115:0.45844428182488):0.17257497230469604):0.7027926447710426,(((7:0.455232018965783,116:0.455232018965783):0.21717200965847883,(((51:0.07525401970399374,87:0.07525401970399374):0.003084860382546392,(64:0.024406941203500065,113:0.024406941203500065):0.05393193888304007):0.5768810765489909,(((54:0.06856795061471396,102:0.06856795061471396):0.14725193340809906,104:0.21581988402281302):0.3801682580938264,73:0.5959881421166394):0.05923181451889159):0.017184071988730842):0.5312666662969483,((18:0.019740135755025055,74:0.019740135755025055):0.29902632335698665,47:0.3187664591120117):0.8849042358091985):0.13014120397940854):0.11789372979258328,((((28:0.2103975489827134,52:0.2103975489827134):0.15920730340436806,37:0.36960485238708146):0.31583189670364614,31:0.6854367490907276):0.4859708168385988,(68:0.9220213704128001,117:0.9220213704128001):0.2493861955165263):0.2802980627638756):0.19182858101079847):0.28299977022422507):0.0;";
        TreeParser tree2 = new TreeParser(newick2, false, false, true, 0);
        UCRelaxedClockModel RelaxedClock2 =new UCRelaxedClockModel();

        //InConstantDistanceOperator operator = new InConstantDistanceOperator();
        //SmallPulleyV1 operator = new SmallPulleyV1();
        BigPulley operator = new BigPulley();

        operator.setInputValue("rates",new RealParameter("0.936091621853684 0.827386337524583 0.946342272292745 1.14154307499299 1.01675441592264 1.10071933247179 0.938004494939011 0.999129519644019 0.979194454999476 0.936112377208736 0.956382021701549 1.02603207217186 1.1323129181369 1.13370514829222 0.891983072932866 0.905895265216444 0.988097588600761 0.962050079646447 0.970957508580484 0.867234671001135 1.1465648900547 0.987148028411761 0.799344868437366 0.848259370535449 0.854023329030513 1.14336960392016 0.778230071611815 0.881699931501436 0.860911479448604 0.964685197570033 1.05300140635224 0.926002187470409 0.976639070370879 0.955457715428828 0.867572613332755 0.950366482610039 0.963324914499785 1.04308284586678 1.23758146229506 0.957429157353827 0.968487791499607 1.05139260610169 1.17723967260696 1.07567040139538 0.811371284632794 1.08765693871303 1.14877823667043 0.92080860585898 1.16900594537437 0.841375688458337 0.96416483076729 1.06177674075481 0.985573206548009 1.14924256514485 1.29704811706245 1.07898538402534 0.90856060837337 1.02283826811532 1.32084207363198 1.21044681883064 0.878150438918473 0.915093304452645 0.985860039114238 0.948603247080185 0.922676362453785 0.907914143419169 1.08196285872999 0.955601359073571 1.22945857100824 0.966352883139802 0.767887334676015 1.07930953425025 0.926159271885228 0.9959130958819 1.06803197442459 1.01908983905378 1.03576764293648 1.02541846971311 1.42299420691329 0.932934005640958 0.810852905956823 1.07624268820765 0.921421389572459 0.759506802196918 0.817542811801588 0.984159385723081 0.758616866943654 0.855938005409555 1.20642299627831 1.21721552421823 1.03807802181605 1.05558347917566 1.18150301907748 1.05673041905265 1.09201875914059 0.922118892190875 1.12931151466209 0.914173040956408 1.09845978580576 0.841276314935983 0.937062569691937 0.806394111526533 0.803915837235395 0.721328987364484 0.860012833490427 1.08600113321781 1.05219593381519 0.909057696084391 1.02165527977831 1.17729936344134 0.945034993811658 0.884457707522978 0.960853839762367 1.20413408579109 1.177808618017 0.892579969792417 1.00801302560682 1.1052540322086 0.845171790611036 0.920843898196977 0.908095505082499 1.14137294858032 1.20432684261134 1.04726515967906 0.973060277874612 1.30973233168183 1.1559398139765 1.07733830326901 0.878354218948212 1.12758004780767 1.28749409929411 1.12064696451211 1.14051042480629 0.838800367374301 0.973607291526751 1.06493148663343 0.86464523978537 1.03736640649312 1.01929029414455 0.763326969043799 0.945931109919182 1.0218290597935 1.26581688037351 0.93432551453898 0.798403657037627 0.954907780264906 1.0273311920502 1.07391538825214 0.868591754901503 0.835582709913381 0.812408700085709 1.03237432944637 0.943441585256152 0.84572838069436 1.04535385967544 1.4057373035605 1.02807714593852 0.942798567617865 0.994129634591114 0.912121678641745 1.00662226046006 1.05549770257239 0.7888394969048 0.943468286619395 0.859394242395583 0.980764610164902 1.09769393336876 1.08951570151555 0.882919133511048 0.930243827593475 1.00307438260207 0.948823439306213 0.827169638043716 1.04724769925006 0.97658075079614 1.04583605831314 0.677813702538089 1.02671747333154 1.06946316858258 1.13982965589736 1.29528288628662 1.14243831464842 0.891726892274575 1.14654581686529 1.16480994339659 0.975678182924859 0.959482169968076 1.06201127128278 1.41112197334174 0.739887669017598 0.996877848880585 0.794097757693482 1.18493684574048 0.840879362579336 0.976458542292366 0.830011583729198 0.864428700890303 0.972488488569087 1.05411637675336 0.902772120852771 1.30856950841522 1.08002773343926 1.12214982006623 1.13973746880955 0.861814125147005 0.886367904026699 1.11863194654359 0.865831181039771 0.800668116105316 0.917336385932314 1.20488470944041 1.13301418297575 0.946249016390257 0.846980647903207 1.3070588853613 0.835523898630557 0.982961677232368 1.13985962682264 1.16923939517873 1.16198115346818 0.925908467940748 0.956397300088686 1.03351415167038 1.04146289773174 1.01734857578877 0.873072004774609 0.873388803894881 0.873869449386848 0.854794599057397 1.13833971125634 1.03001977033945 0.899631160760152 1.03990909156482 1.0977125515043 1.13115476025937 0.982452039507629 0.894306082958243 1.1637739785244"));

        //operator.initByName("tree",tree2,"branchRateModel",RelaxedClock,"twindowSize",0.1,"weight",10.0);
        operator.initByName("tree",tree2,"branchRateModel",RelaxedClock2,"dwindowSize",0.1,"twindowSize",0.1,"weight",10.0);

        operator.proposal();
    }
    */
